// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Object {
  id   Int    @id @default(autoincrement())
  name String

  snapshotId Int      @map("snapshot_id")
  snapshot   Snapshot @relation(fields: [snapshotId], references: [id], onDelete: Cascade)

  Blob   Blob? @relation(fields: [blobId], references: [id])
  blobId Int?  @map("blob_id")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("objects")
}

model Blob {
  id      Int      @id @default(autoincrement())
  data    Bytes
  hash    String
  objects Object[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("blobs")
}

model Snapshot {
  id     Int @id @default(autoincrement())
  number Int

  directoryId Int       @map("directory_id")
  directory   Directory @relation(fields: [directoryId], references: [id])
  objects     Object[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("snapshots")
}

model Directory {
  id   Int    @id @default(autoincrement())
  path String @unique

  snapshots Snapshot[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("directory")
}
